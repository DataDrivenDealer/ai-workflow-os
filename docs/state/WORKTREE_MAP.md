# WORKTREE MAP

> **Last Updated**: 2026-02-05T16:00:00
> **Base Path**: `.worktrees`
> **Max Worktrees**: 5

---

## Active Worktrees

*No active worktrees.*

---

## Purpose Categories

| Purpose | Description | Typical Use Case |
|---------|-------------|------------------|
| `subagent` | Parallel subagent execution | Isolated research, spec retrieval |
| `experiment` | Experiment runs | Factor testing, backtest runs |
| `hotfix` | Urgent fixes | Production issues |
| `review` | Code review isolation | PR review, pair programming |
| `backup` | Pre-destructive backup | Before refactors, bulk deletes |

---

## Workflow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         WORKTREE LIFECYCLE                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  Main Worktree (.)                    Parallel Worktree (.worktrees/xxx)
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
         â”‚                                        â”‚
         â”‚  1. Create worktree                    â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ (idle)
         â”‚                                        â”‚
         â”‚  2. Activate for task                  â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ (active)
         â”‚                                        â”‚
         â”‚                            3. Work...  â”‚
         â”‚                                        â”‚
         â”‚  4. Merge results                      â”‚
         â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
         â”‚                                        â”‚
         â”‚  5. Mark idle or remove                â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ (idle/removed)
         â”‚                                        â”‚
```

---

## Usage Commands

```bash
# Create a new worktree for subagent
python kernel/worktree_manager.py create --name subagent-001 --branch feat/task-001 --purpose subagent

# List all worktrees
python kernel/worktree_manager.py list

# Mark worktree as active with task
python kernel/worktree_manager.py activate --name subagent-001 --task-id T3.1

# Mark worktree as idle
python kernel/worktree_manager.py idle --name subagent-001

# Remove a worktree
python kernel/worktree_manager.py remove --name subagent-001

# Cleanup stale worktrees (idle > 24h)
python kernel/worktree_manager.py cleanup

# Get/create worktree for specific subagent
python kernel/worktree_manager.py get-subagent --id repo_specs_retrieval
```

---

## Integration with Subagents

When a subagent is invoked, the system can:

1. **Check** for available idle worktree via `get-subagent`
2. **Create** a new worktree if none available (up to limit)
3. **Execute** subagent in isolated directory
4. **Merge** results back to main branch
5. **Idle** or **Remove** worktree after completion

This enables:
- ðŸ”’ **Isolation**: Subagent changes don't affect main working directory
- âš¡ **Parallelism**: Multiple subagents can run simultaneously
- ðŸ”„ **Rollback**: Easy to discard failed experiments
- ðŸ“Š **Tracking**: All worktree usage is logged

---

## State Files

| File | Purpose |
|------|---------|
| `state/worktrees.yaml` | Worktree state (YAML format) |
| `docs/state/WORKTREE_MAP.md` | Human-readable map (this file) |

---

*Auto-generated by `kernel/worktree_manager.py`*
